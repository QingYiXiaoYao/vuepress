---
title: 'UDI管理系统'
editLink: false
---
UDI管理系统

UDI 一站式服务（平台介绍：https://www.loogal.com/management/），直接对接国家药监局数据库的 UDI  合规申报平台，帮助企业将产品 UDI  信息提交 China NMPA（国家药品监督管理局） ，以符合法规要求
主要模块有 企业信息管理、合规申请、注册证管理、编码管理、库存管理、产品追溯、扫码关联等

担任项目的前端负责人，因项目前期项目方急需一个展示的demo，选用了的 Vue-admin-template 技术框架，快速搭建了平台，根据已有需求先开发了用户模块、企业信息模块；

根据需求，权限指控的模式为：企业之间数据隔离，企业用户分配角色（岗位），角色分配可见的页面（查看）以及页面中的可操作的权限（新增、编辑、删除、编码等，前后端协商后使用统一的权限标识）；
为了提升登录后初始页面渲染效率，前端配置一些基础路由（如dashboard，404）,其他页面，服务器端根据权限控制返回的路由数据；打开页面后，页面的操作权限，根据获取到的权限标识数据进行控制。
为了更方便的使用权限控制和统一处理，自定义权限指令，在全局引用，页面中只需配置相应的权限标识

项目中，根据药监局提供的一套接口和数据上报的规则，用户将药监局申请APPID和APPsecret录入到企业信息模块中，在注册证管理模块录入相应的注册证信息（例如：国械注进20153094152
），用户就可以开始申报产品信息了，产品信息字段很多，梳理时分为了三类：必填、条件必填、非必填
核心字段是最小销售单元产品标识（14位整数），这个字段由1位包装标识符（通常设置为0），8位企业注册码，4位产品代码，以及根据前面13位确定的数字计算出最后一位的数字组成 [ 最后一位数字：((偶数位和)*3 + 奇数位和)的结果与大于这个结果的最小整十数的差值 = 校验码，如果校验码为10，则取0 ]
其他要注意的字段有产品标识发布日期（不能小于当前日期），包装标识信息（数据结构为一个数组，为最小销售单元产品的大一级包装，多级的话添加多个数据，每级之间标识信息需要关联）等

产品信息申报流程，通过状态信息标识申报的每个阶段，3个部分 本地-上传-公示
本地草稿阶段会根据已有和测试出来的校验规则，对数据进行校验，通过后允许上传（减少与药监局之前的数据交互）
数据上传到药监局数据库后，不需要再修改时，可继续公示阶段，此时如果数据需要修改，则可以通过药监局提供的接口进行修改，平台流程则退回到本地草稿阶段，修改完成后，继续下一个阶段
通过接口将产品数据公示后，就可以用于生产产品包装了，公示阶段如果需要修改数据（如发现数据错误或者产品发布日期需要延后），则可以通过药监局提供的接口进行修改，修改完后，重新进行申报流程
（细节：将上传和公示阶段的修改后的本地草稿标识为不同状态，可以追溯产品申报的完整流程）

产品申报完成后，就可进行编码，生成实际用于产品的UDI码（对应一个单独的产品），UDI码由DI码（最小销售单元产品标识、包装标识等）和PI码组成（由生产日期、有效期、批号、系列号等AI组成），其中，每个AI的长度和格式都有要求，AI之间的前后顺序可以调整，每个非固定长度的AI码由分割标识符区分

产品编码后，就可以入库了，设置仓库信息，录入UDI码，进行出入库、查询库存、数据追溯等操作
为了更方便的操作，提供了扫码录入UDI码的功能，2中扫码枪（串口、键盘），键盘模式的扫码枪通过监听keydown事件，获取录入的每个字符，拼接起来后，输入到相应的输入框中；串口扫码枪，则是利用webapi的 navigator 对象，提供的serial接口连接到扫码枪，在利用webapi的TextDecoderStream接口将串口读取的二进制数据转换为字符串，格式整理后输入到相应输入框中

该项目主要是业务驱动型，前端，为了提升效率和性能，
使用函数式组件（局部组件使用，渲染快）
提取复用组件、复用代码和公共函数，
路由懒加载，
区分需要响应的数据和只展示的数据（减少需要添加响应data中的数据），
开启gzip压缩，
压缩图片，
数据量大的页面分批处理（防止一次性执行数据太大或计算复杂而阻塞页面渲染），
将复杂、数据量多的的表单页面拆分为多个子组件，视口附近组件优先加载，后续组件懒加载


